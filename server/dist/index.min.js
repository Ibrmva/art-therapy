"use strict";var model,express=require("express"),multer=require("multer"),tf=require("@tensorflow/tfjs-node"),_require=require("canvas"),createCanvas=_require.createCanvas,loadImage=_require.loadImage,fs=require("fs"),path=require("path"),app=express(),port=4e3,storage=multer.memoryStorage(),upload=multer({storage:storage});function loadModel(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(tf.loadGraphModel("https://tfhub.dev/tensorflow/deeplabv3/1/default/1",{fromTFHub:!0}));case 2:model=e.sent,console.log("Model Loaded");case 4:case"end":return e.stop()}})}loadModel(),app.post("/segmentImage",upload.single("image"),function(r,t){var a,n,o,s,u,i,l,d,c,g,p,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.file){e.next=2;break}return e.abrupt("return",t.status(400).send({error:"No file uploaded"}));case 2:return e.prev=2,a=r.file.buffer,e.next=6,regeneratorRuntime.awrap(loadImage(a));case 6:return n=e.sent,o=createCanvas(n.width,n.height),o.getContext("2d").drawImage(n,0,0),s=(s=tf.browser.fromPixels(o)).expandDims(0),e.next=14,regeneratorRuntime.awrap(model.executeAsync(s));case 14:u=e.sent,i=u[0].squeeze(),l=i.mul(255).toInt(),d=createCanvas(n.width,n.height),c=d.getContext("2d"),g=l.dataSync(),c.putImageData(new ImageData(Uint8ClampedArray.from(g),n.width,n.height),0,0),p=d.toBuffer("image/jpeg"),m=p.toString("base64"),t.json({segmentedImage:"data:image/jpeg;base64,".concat(m)}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(2),console.error("Error during segmentation:",e.t0),t.status(500).send({error:"Error during image segmentation"});case 30:case"end":return e.stop()}},null,null,[[2,26]])}),app.listen(port,function(){console.log("Server is running on http://localhost:".concat(port))});
//# sourceMappingURL=index.min.js.map
