"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _express=_interopRequireDefault(require("express")),_child_process=require("child_process"),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var router=_express.default.Router(),saveBase64Image=function(e,r){var t=e.replace(/^data:image\/\w+;base64,/,""),o=Buffer.from(t,"base64");_fs.default.writeFileSync(r,o)},removeFile=function(e){_fs.default.existsSync(e)&&_fs.default.unlinkSync(e)};router.post("/convertRasterToVector",function(r,s){var t,o,a,n,i,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=r.body,o=t.image,a=t.maxColors,void 0===a?24:a,o&&"string"==typeof o){e.next=4;break}return e.abrupt("return",s.status(400).json({error:"Invalid or missing 'image' in request body"}));case 4:n=_path.default.join(__dirname,"temp","input.png"),i=_path.default.join(__dirname,"temp","output.svg"),saveBase64Image(o,n),u='potrace --svg --color="#000000" --turdsize=0 --progress -u 1 -a 1 --alphamax=1 -k 0.4 --flat '.concat(n," -o ").concat(i),(0,_child_process.exec)(u,function(e,r,t){if(e)return console.error("Error during vectorization:",e.message),removeFile(n),s.status(500).json({error:"Vectorization failed",message:e.message});t&&console.warn("Vectorization stderr:",t);var o=_fs.default.readFileSync(i,"utf-8");removeFile(n),removeFile(i),console.log("Vectorization completed successfully"),s.status(200).json({vectorImage:o})}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error in /convertRasterToVector route:",e.t0.message),s.status(500).json({error:"Failed to process image",message:e.t0.message});case 15:case"end":return e.stop()}},null,null,[[0,11]])});var _default=router;exports.default=_default;
//# sourceMappingURL=vectorization.min.js.map
